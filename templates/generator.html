<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Generator - PantryChef</title>
    <link rel="stylesheet" href="/static/generrator.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="container">
                <div class="logo">
                    <a href="index.html">
                        <img src="/assets/logo.png" alt="PantryChef Logo">
                    </a>
                </div>
                <div class="nav-links" id="navLinks">
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="generator.html" class="active">Recipe Generator</a></li>
                        <li><a href="community.html">Community</a></li>
                        <li><a href="contact.html">Feedback & Queries</a></li>
                    </ul>
                </div>
                <div class="auth-buttons">
                    <a href="login.html" class="btn btn-outline">Login</a>
                    <a href="signup.html" class="btn btn-primary">Sign Up</a>
                </div>
                <div class="menu-toggle" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </div>
            </div>
        </nav>
    </header>

    <main>
        <section class="generator-hero">
            <div class="container">
                <div class="generator-hero-content">
                    <h1>AI Recipe Generator</h1>
                    <p>Upload an image of your ingredients or manually enter them to get personalized recipe suggestions</p>
                </div>
            </div>
        </section>

        <section class="generator-section">
            <div class="container">
                <div class="generator-card">
                    <div class="generator-form">
                        <h2><i class="fas fa-utensils"></i> Find Recipes with Your Ingredients</h2>
                        <form id="uploadForm" enctype="multipart/form-data">
                            <div class="form-group">
                                <label for="fileInput">
                                    <i class="fas fa-camera"></i> Upload Image of Ingredients
                                </label>
                                <div class="file-input-wrapper">
                                    <input type="file" name="file" id="fileInput" accept="image/*" required>
                                    <div class="file-preview">
                                        <span id="fileName">No file selected</span>
                                        <i class="fas fa-upload"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="manualIngredients">
                                    <i class="fas fa-list"></i> Enter Additional Ingredients (optional)
                                </label>
                                <input type="text" name="manual_ingredients" id="manualIngredients" 
                                       placeholder="e.g., tomatoes, chicken, rice (comma separated)">
                            </div>
                            
                            <div class="form-group">
                                <button type="submit" class="btn btn-primary btn-large">
                                    <i class="fas fa-magic"></i> Generate Recipes
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="result-container" id="result">
                    <div class="result-card">
                        <div class="result-header">
                            <h2>Your Ingredients</h2>
                        </div>
                        <div class="result-body">
                            <div class="uploaded-image-container">
                                <h3>Uploaded Image</h3>
                                <div class="uploaded-image">
                                    <img id="uploadedImage" src="" alt="Uploaded image">
                                </div>
                            </div>
                            
                            <div class="ingredients-list">
                                <h3>Detected Ingredients</h3>
                                <div class="ingredients-chips" id="ingredients-container">
                                    <!-- Ingredient chips will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="recipes-container">
                        <h2>Recipe Suggestions</h2>
                        <div class="recipes-grid" id="recipes">
                            <!-- Recipe cards will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <img src="/assets/logo.png" alt="PantryChef Logo">
                    <p>PantryChef - Smart Recipe Suggestions</p>
                </div>
                <div class="footer-links">
                    <div class="link-group">
                        <h3>Navigation</h3>
                        <ul>
                            <li><a href="index.html">Home</a></li>
                            <li><a href="generator.html">Recipe Generator</a></li>
                            <li><a href="community.html">Community</a></li>
                            <li><a href="contact.html">Contact</a></li>
                        </ul>
                    </div>
                    <div class="link-group">
                        <h3>Account</h3>
                        <ul>
                            <li><a href="login.html">Login</a></li>
                            <li><a href="signup.html">Sign Up</a></li>
                            <li><a href="#">My Profile</a></li>
                            <li><a href="#">Saved Recipes</a></li>
                        </ul>
                    </div>
                    <div class="link-group">
                        <h3>Legal</h3>
                        <ul>
                            <li><a href="#">Privacy Policy</a></li>
                            <li><a href="#">Terms of Service</a></li>
                            <li><a href="#">Cookie Policy</a></li>
                        </ul>
                    </div>
                </div>
                <div class="footer-social">
                    <h3>Connect With Us</h3>
                    <div class="social-icons">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-pinterest"></i></a>
                    </div>
                    <div class="newsletter">
                        <h3>Subscribe to Our Newsletter</h3>
                        <form class="newsletter-form">
                            <input type="email" placeholder="Your email address">
                            <button type="submit" class="btn btn-primary">Subscribe</button>
                        </form>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 PantryChef. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
    $(document).ready(function() {
        // Show file name when selected
        $('#fileInput').change(function() {
            const fileName = $(this).val().split('\\').pop();
            $('#fileName').text(fileName || 'No file selected');
        });

        // Handle menu toggle for responsive design
        $('#menuToggle').click(function() {
            $('#navLinks').toggleClass('active');
        });

        // Form submission
        $("#uploadForm").submit(function(event) {
            event.preventDefault();
            var formData = new FormData(this);
            
            // Show loading state
            $('button[type="submit"]').html('<i class="fas fa-spinner fa-spin"></i> Processing...');
            
            $.ajax({
                url: "/upload",
                type: "POST",
                data: formData,
                contentType: false,
                processData: false,
                success: function(response) {
                    // Reset button state
                    $('button[type="submit"]').html('<i class="fas fa-magic"></i> Generate Recipes');
                    
                    // Display results
                    $("#result").show();
                    $("#uploadedImage").attr("src", response.image_url);
                    
                    // Create ingredient chips
                    $("#ingredients-container").empty();
                    response.ingredients.split(', ').forEach(ingredient => {
                        if (ingredient.trim()) {
                            $("#ingredients-container").append(
                                `<span class="ingredient-chip">${ingredient.trim()}</span>`
                            );
                        }
                    });
                    // Create recipe cards
                    $("#recipes").empty();
                    let lines = response.recipes.split('\n').filter(line => line.trim() !== '');
                    let currentGrid = null;
                    let isSubGrid = false;
                
                    lines.forEach((line, index) => {
                        const recipe = line.trim();
                        if (!recipe) return;
                
                        // Create main grid container for every 2nd recipe
                        if (index % 7 === 0 || currentGrid === null) {
                            currentGrid = $('<div class="main-recipe-grid"></div>');
                            $("#recipes").append(currentGrid);
                            isSubGrid = false;
                        }
                
                        // Create subgrid after 2 main recipes
                        if (index > 1 && (index - 2) % 5 === 0 && !isSubGrid) {
                            const subGrid = $('<div class="sub-recipe-grid"></div>');
                            currentGrid.append(subGrid);
                            currentGrid = subGrid;
                            isSubGrid = true;
                        }
                
                        const recipeCard = `
                            <div class="recipe-card ${isSubGrid ? 'sub-recipe' : ''}">
                                <div class="recipe-content">
                                    <h3>${recipe}</h3>
                                    <p>A delicious recipe using your available ingredients.</p>
                                    <a href="#" class="btn btn-outline">View Recipe</a>
                                </div>
                            </div>
                        `;
                
                        currentGrid.append(recipeCard);
                    });
                
                    
                    // Scroll to results
                    $('html, body').animate({
                        scrollTop: $("#result").offset().top - 100
                    }, 1000);
                },
                error: function(xhr) {
                    // Reset button state
                    $('button[type="submit"]').html('<i class="fas fa-magic"></i> Generate Recipes');
                    alert("Error: " + (xhr.responseJSON ? xhr.responseJSON.error : "Failed to process request"));
                }
            });
        });
    });
    </script>
</body>
</html>